
## Ch6. 여러 텍스트 파일 일괄 편집(sed)

- sed
    - Stream EDitor
    - 텍스트 편집용 도구
    - vim과 같이 텍스트 파일 내용을 표시하면서 대화식으로 편집하는 스크린 데이터와 달리 
    - 스크림 데이터는 대화식이 아니라 텍스트를 어떻게 편집하는 가는 명령줄 옵션으로 지정해서 지시한다 

   

```
$ sed --expression "4d"
      --expression "6i xxx"
# --expression 또는 -e 옵션 하나가 sed에 대한 하나의 지시가 됨(이 옵션은 여러번 지정 가능)


$ cat file.txt | sed -e "4d" -e "6i xxx" | less
# -e : 편집 조작 지시
#미리 지정한 지시에 따라 파일이나 파이프라인 입력을 편집해서 출력한다 

```


```

# vim 명령어로 일괄치환

:%s/치환전 문자열/치환후 문자열/

# sed 옵션으로 일괄치환

$ sed -e "s/치환전 문자열/친환후 문자열/"


# 치환전이나 치환후 문자에 /가 포함되면 구분자를 바꿔서 ;치환전;치환후; 처럼 사용


$ sed [옵션] 스크립트 입력파일1 [입력파일2 ... ]


$ cat sample.txt | sed -e "s/반환중/회수완료/" > sample.csv
# 명령어 실행하고 나면 파일이 비어 있게 된다 
# 하나의 명령어열에서 파일을 여는 조작고 파일에 기록하는 조작을 동시에 하게 되면 파일이 사라지게 된다
# sed 뿐만 아니라 파일 내용을 편집하고 결과를 리다이렉틓패서 덮어써서 저장하려면 다른 방법을 써야 한다 


```

- 충돌 방지하기 위해 원래 파일을 미리 다른 이름으로 변경해 두는 방법을 사용한다 

```
$ source = /tmp/sample.csv
$ backup = ${source}/${date +%Y-%m-%d).bak # 날짜를 파일명에 적으면 다중 백업으로 이용가능 

$ mv $source $backup

cat $backup | sed -e "s/반환중/회수완료/" > $source # 입력하는 것과 다른 파일이므로 내용이 사라지지 않는다

$ sed -i ".bak" -e "s/반환중/회수완료/" > sample.csv
# 또 다른 방법으로는 sed 자체가 파일을 저장하는 -i 옵션이 있다
# 환경에 따라서 미묘하게 지정 방법이 다르다는 것과 파일을 직접 변경할 때만 사용할 수 있으므로 주의해야 한다 
```

- for 반복문과 sed를 사용하면 여러 파일도 한번에 편집할 수 있다 

```
#!/bin/bash
for file in *.csv
do
    backup = ${source}/${date +%Y-%m-%d).bak
    mv $file $backup
    cat $backup | sed -e "s/반환중/회수완료/" $file
done

```

- 텍스트 파일 뿐만 아니라 다른 명령어 출력 결과를 조금 고치는 데도 사용할 수 있다

```
$ cat access/log | cut -d " " -f 7 |
    sed -e "s/index.html//" |
        sort | unique -c |
            sort -n
# index.html 부분을 빈문자로 치환(=삭제)해서 index.html 우뮤의 차이를 무시할 수 있도록 함

```
- 셸 스크립트에서 텍스트를 자동 편집하고 싶을 때 sed 사용
- sed로 문자열을 일괄 치환하려면 sed -e "s/치환전/치환후/"지정
- 셸 스크립트에서 기존 파일을 편집해서 덮어쓰기를 할 때는 주의가 필요하다
- 일단 다른 파일명으로 변경해두고 원래 파일 위치에 출력하는 등으로 같을 파일을 하나의 처리에서 읽고 쓰지 않도록 해야 함

## Reference

  - [만화로 배우는 리눅스 시스템 관리](http://www.yes24.com/Product/Goods/32402055?Acode=101)
