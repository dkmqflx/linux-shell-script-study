
# Ch2. 키 인증으로 안전하게 로그인

- 암호 인증
    - scp나 ssh로 서버에 로그인할 때 암호를 입력하는 방식
    - 이 방법은 간단하고 단순하지만 암호가 네트워크를 통해 교환되는 문제점 있다 
    - 네트쿼으 감청 때문에 암호를 빼앗길 위험성 있으므로 키 인증 방식을 사용하기도 한다 
    
    
- 키 인증
    - 공개키와 비밀키라는 한쌍의 키 파일을 사용하는 인증 방식
    - 공개키(암호화용 키)로 중요한 데이터를 암호화한다
    - 비밀키(복원용 키)로 데이터를 꺼내 볼 수 있다 
    - 이러한 키 쌍은 공개키를 사용해 암호화한 데이터는 대칭이 되는 비ㅣㄹ키가 아니면 복호화할 수 없다 
    - 공개키 암호를 사용해서 상대가 진짜 비밀키를 가진 사람인가를 확인 하는 인증 방식
    - 키 인증은 암호 인증과 달리 비밀키 자체가 네트워크에 노출되는 일이 없어 조금 더 안전한 방식


```
$ ssh-keygen

# 처음에는 키 저장 위치를 물어본다
# 기본 위치에 저장하는 경우 그냥 Enter

# 그 다음은 비밀키의 패스프레이즈 입력
# 키 인증도 비밀키를 도둑맞으면 암호가 털릴 수 있기 때문에 훔쳐가더라도 바로 악용할 수 없도록 평소에는 봉인해 둔다
# 패스프레이즈는 키 봉인을 풀기위한 암구호

# 비밀키 저장 장소
# 공개키 저장 장소가 각각 출력된다 

```

- mkdir -p 옵션
    - -p 옵션을 사용할 경우 존재하지 않는 중간의 디렉토리를 자동으로 생성해 준다 
    
    
```
$ mkdir a1/a2/a3
# 에러 발생

$ mkdir -p a1/a2/a3
# 중간 디렉토리도 자동으로 생성해 준다 
```

- 공개키 등록
    - 공개키 파일을 특정 위치에 넣어 두는 것
    - 우선 공개키 파일을 서버에 복사한다
    - 그 다음, 그 키 쌍으로 인증하고 싶은 사용자 홈 디렉터리 바로 아래의 .ssh 디렉터리에 authorized_keys라는 이름으로 저장한다 
    - 그리고 그 사용자 이외에는 읽고 쓸 수 없더록 .ssh 디렉터리와 authorized_keys 권한을 설정한다 

```
# 공개키 등록

$ scp id_rsa.pub usr@192.168.11.105:/tmp
$ ssh usrusr@192.168.11.105
$ sudo mkdir -p ~usr/.ssh/ # 디렉토리가 없으면 작성함
$ sudo mv /tmp/id_rsa.pub ~usr/.ssh/authorized_keys

$ sudo chown -R usr:usr ~usr/.ssh # 소유자를 해당 사용자로, 그룹도 해당 사용자 그룹으로 설정
$ sudo chmod 700 ~usr/.ssh # 디렉터리 권한 700 -> 소유자만 읽고, 쓰기, 관람 가능
$ sudo chmod 600 ~usr/.ssh/authorized_keys # 파일 권한 600 -> 소유자만 읽고 쓰기 가능


```

- chwon 
    - 파일의 소유자나 그룹을 변경
    
```
$ chwon root FILE # FILE의 소유 유저를 root로 변경한다 

$ chwon root:staff FILE # FILE의 소유 유저를 root로, 그룹을 staff로 변경한다 
```

- 비밀키 파일은 다른 사람이 접근 못하게 조심해서 다룬다
- 비밀키 자체가 유출되면 패스프레이즈도 쉽게 뚫릴수 있기 때문이다
- 이러한 경우 키 쌍을 다시 만들어서 공개키를 등록해야 한다 
