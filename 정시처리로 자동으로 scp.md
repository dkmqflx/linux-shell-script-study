
## Ch3. 정시처리로 자동으로 scp

- cronjob으로 scp를 하려면 자동인증용 패스프레이지 없는 비밀키를 사용한다 
- 키 쌍을 작성할 때 패스프레이지를 입랴력하지 않을 수 있다
- 이렇게 만든 비밀키는 키 인증 때도 패스프레이지를 입력하지 않아도 그대로 사용할 수 있다 

```
$ ssh-keygen

$ /home/mint/.ssh/logdl # 전체 경로 지정, 경로를 지정하지 않으면 전에 만든키를 덮어쓸 수 있으므로 주의한다

# 아무것도 입력하지 않고 Enter 두번 하면 패스프레이지를 입력하지 않고 키쌍을 만들 수 있다 
```


- 만든 키를 서버에 등록하고 특정 명령여를 싱행하는 전용키로 설정한다 
- 키 인증은 공개키 하나당 멍령어열을 하나만 지정할 수 있다 
- 자동 인증용 키에 어떠한 제한도 없다면 혹시라도 비밀키가 유출되었을 때 악용될 수 있다 
- 비밀키가 유출되더라도 피해가 확대되지 않도록 그 키로 할 수 있는 것을 최소화하는 것이 키 인증의 원칙



```
# 공개키가 이미 등록되어있는 경우 아래와 같이 새로운 공개키를 추가로 등록한다 

$ scp ~/.ssh/logdl.pub usr@192.168.11.51"/tmp/
$ ssh usr@192.168.11.51
$ cat /tmp/logdl.pub >> ~/.ssh/authorized_keys # 기존 파일 끝에 추가하기 

$ vim ~/.ssh/authorized_keys
# 이 전에 등록한 공개키와 방금 추가한 공개키 가 나온다 
# 자동 인증용 공개키 앞줄에 아래 명령어 열을 추가한다 

command "scp -f /var/log/apache/access.log" # 서버 쪽 scp 명령어 
# 추가적으로 권한을 변경해 준다 

# authorized_keys에 commadn = "명령어열"을 쓰면 그 공개키로 인증했을 때 지정한 명령어 이외에는 실행할 수 없다 

# 파일을 다운로드 할때 scp -f 서버 파일 경로 
# 파일을 업로드 할 때 scp -t 서버 파일 경로 
```

```
# ssh나 scp는 초기 상태라면 정해진 위치(~/.ssh/id_rsa 등)에 있는 비밀키를 사용한다 
# 따라서 지금 만든 자동 인증용 키처럼 다른 비밀키를 사용하고 싶다면 -i 옵션으로 경로를 지정해야 한다 
# -i 옵션 : identity file, 사용자 식별용 파일(비밀키)의 첫 글자

$ scp -i ~/.ssh/logdl.pub usr@192.168.11.51"/tmp/
```
